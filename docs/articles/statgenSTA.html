<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modeling field trials using statgenSTA • statgenSTA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modeling field trials using statgenSTA">
<meta property="og:description" content="statgenSTA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">statgenSTA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fas fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-seedling"></span>
     
    other packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://biometris.github.io/statgenGxE">statgenGxE</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenGWAS">statgenGWAS</a>
    </li>
    <li>
      <a href="https://biometris.github.io/statgenHTP">statgenHTP</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/Biometris/statgenSTA">
    <span class="fas fa-github fa-lg fab"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="statgenSTA_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Modeling field trials using statgenSTA</h1>
                        <h4 class="author">Bart-Jan van Rossum</h4>
            
            <h4 class="date">2021-03-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Biometris/statgenSTA/blob/master/vignettes/statgenSTA.Rmd"><code>vignettes/statgenSTA.Rmd</code></a></small>
      <div class="hidden name"><code>statgenSTA.Rmd</code></div>

    </div>

    
    
<div id="the-statgensta-package" class="section level1">
<h1 class="hasAnchor">
<a href="#the-statgensta-package" class="anchor"></a>The statgenSTA Package</h1>
<p>The statgenSTA (Single Trial Analysis) package is developed as an easy-to-use package for analyzing data of plant breeding experiments with many options for plotting and reporting the results of the analyses.</p>
<p>This vignette describes in detail how to prepare data for analysis, perform analyses using different modeling engines and extract the results from the models.</p>
<hr>
</div>
<div id="data-preparation" class="section level1">
<h1 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h1>
<p>The first step when modeling field trial data with the statgenSTA package is creating an object of class <code>TD</code> (Trial Data). This object is used throughout the statgenSTA package as input for analyses.</p>
<div id="creating-a-td-object" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-td-object" class="anchor"></a>Creating a <code>TD</code> object</h2>
<p>A <code>TD</code> object can be created from a <code>data.frame</code> with the function <code>createTD</code>. This function does a number of things:</p>
<ul>
<li>Rename columns to default column names used by the functions in the statgenSTA package. For example, the column in the data containing variety/accession/genotype is renamed to “genotype.” Original column names are stored as an attribute of the <code>TD</code> object.</li>
<li>Convert column types to the default column types. For example, the column “genotype” is converted to a factor and “rowCoord” to a numeric column.</li>
<li>Split the data into separate data.frames by trial. A <code>TD</code> object is a <code>list</code> of <code>data.frames</code> where each <code>data.frame</code> contains the data for a single trial. If there is only one trial or no column trial is defined, the output will be a <code>list</code> with only one item.</li>
<li>Add meta data to the <code>TD</code> object. This meta data is used to store background information about the trials. It consists of location, date of the experiment, longitude, latitude, trial design, plot width and plot length. None of these are strictly necessary for any analysis and meta data can therefore be safely ignored. However the meta data is used when plotting field layouts, plotting trials on a map and naming plots. Meta data can be added when creating the <code>TD</code> object using the appropriate parameters in <code>createTD</code> (see <a href="#ex"><strong>2.2</strong></a>). It is also possible to first create a <code>TD</code> object without meta data and then add meta data using the <code>getMeta</code> and <code>setMeta</code> functions (see <a href="#meta"><strong>2.3</strong></a>).</li>
</ul>
<p>After creating a <code>TD</code> object, data for new trials can be added to it using <code>addTD</code>. This function works in exactly the same way as <code>createTD</code> except that it adds data to an existing <code>TD</code> object instead of creating a new one.<br>
Dropping one or more trials from a <code>TD</code> object can be done using the function <code>dropTD</code>.</p>
</div>
<div id="ex" class="section level2">
<h2 class="hasAnchor">
<a href="#ex" class="anchor"></a>Example</h2>
<p>The use of the package is demonstrated using maize data from the European Union project DROPS (<a href="https://cordis.europa.eu/project/id/244374" class="uri">https://cordis.europa.eu/project/id/244374</a>). The data is available from <a href="https://doi.org/10.15454/IASSTN" class="uri">https://doi.org/10.15454/IASSTN</a> <span class="citation">(E. J. Millet et al. 2019)</span> and the relevant data set is included as data.frame in the statgenSTA package.</p>
<p>The first step is loading the data into R.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">dropsRaw</span><span class="op">)</span></code></pre></div>
<p>dropsRaw contains data for 256 maize hybrids, grown with two water regimes (irrigated or rainfed), in seven fields in 2012 and 2013. The hybrids are divided in four families. A selection of ten experiments and eight traits is made from the full data set. These ten experiments form a good representation of the full set of experiments covering the five scenarios described in <span class="citation">E. Millet et al. (2016)</span>. Throughout this vignette in all examples the trait grain.yield will be analyzed. For a more detailed description of the contents of the data see <code><a href="../reference/dropsRaw.html">help(dropsRaw)</a></code>.</p>
<p>For the example, first a <code>TD</code> object is created for experiments conducted in 2012. The data for 2013 is then added later on. In practice all this could be done in one go.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Create a TD object containing for 2012.</span>
<span class="va">dropsTD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TD.html">createTD</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dropsRaw</span><span class="op">[</span><span class="va">dropsRaw</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2012</span>, <span class="op">]</span>,
                    genotype <span class="op">=</span> <span class="st">"Variety_ID"</span>, 
                    trial <span class="op">=</span> <span class="st">"Experiment"</span>,
                    loc <span class="op">=</span> <span class="st">"Site"</span>,
                    repId <span class="op">=</span> <span class="st">"Replicate"</span>, 
                    subBlock <span class="op">=</span> <span class="st">"block"</span>,
                    rowCoord <span class="op">=</span> <span class="st">"Row"</span>, 
                    colCoord <span class="op">=</span> <span class="st">"Column"</span>, 
                    trLat <span class="op">=</span> <span class="st">"Lat"</span>, 
                    trLong <span class="op">=</span> <span class="st">"Long"</span><span class="op">)</span></code></pre></div>
<p>The <code>TD</code> object just created is a <code>list</code> with five items, one for each trial (combination of location, year and water regime) in the original <code>data.frame</code>. The column “Variety_ID” in the original data is renamed to “genotype” and converted to a factor. The columns “Replicate,” “block,” “loc” are renamed and converted likewise. The columns “Row” and “Column” are renamed to “rowCoord” and “colCoord” respectively. Simultaneously two columns “rowId” and “colId” are created containing the same information converted to a factor. This seemingly duplicate information is needed for spatial analysis. It is possible to define different columns as “rowId” and “colId” than the ones used as “rowCoord” and “colCoord.” Finally, the latitude and longitude of the trials is read from the column “Lat” and “Long” in the input and stored in <code>dropsTD</code>. The information about which columns have been renamed when creating a <code>TD</code> object is stored as an attribute of each individual <code>data.frame</code> in the object.</p>
</div>
<div id="meta" class="section level2">
<h2 class="hasAnchor">
<a href="#meta" class="anchor"></a>Meta data</h2>
<p>The meta data will be a <code>data.frame</code> with five rows, one for each trial in <code>dropsTD</code>. The <code>data.frame</code> has the following columns:</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">Content</th>
<th align="left">Usage</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">trLocation</td>
<td align="left">Location</td>
<td align="left">Default names for plots and reports</td>
</tr>
<tr class="even">
<td align="left">trDate</td>
<td align="left">Date</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">trDesign</td>
<td align="left">Design</td>
<td align="left">Model specification (see <a href="#modType"><strong>3.1</strong></a>)</td>
</tr>
<tr class="even">
<td align="left">trLat</td>
<td align="left">Latitude</td>
<td align="left">Position in a map plot (see <a href="#mapPlot"><strong>2.6.2</strong></a>)</td>
</tr>
<tr class="odd">
<td align="left">trLong</td>
<td align="left">Longitude</td>
<td align="left">Position in a map plot (see <a href="#mapPlot"><strong>2.6.2</strong></a>)</td>
</tr>
<tr class="even">
<td align="left">trPlWidth</td>
<td align="left">Plot width</td>
<td align="left">Ratio of width/height in a layout plot (see <a href="#layPlot"><strong>2.6.1</strong></a>)</td>
</tr>
<tr class="odd">
<td align="left">trPlLength</td>
<td align="left">Plot length</td>
<td align="left">Ratio of width/height in a layout plot (see <a href="#layPlot"><strong>2.6.1</strong></a>)</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Extract meta data from the TD object. </span>
<span class="op">(</span><span class="va">dropsMeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMeta.html">getMeta</a></span><span class="op">(</span>TD <span class="op">=</span> <span class="va">dropsTD</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;        trLocation trDate trDesign  trLat trLong trPlWidth trPlLength</span>
<span class="co">#&gt; Cam12R Campagnola   &lt;NA&gt;       NA 45.171  9.532        NA         NA</span>
<span class="co">#&gt; Cra12R    Craiova   &lt;NA&gt;       NA 44.116 24.348        NA         NA</span>
<span class="co">#&gt; Gai12W    Gaillac   &lt;NA&gt;       NA 43.910  1.890        NA         NA</span>
<span class="co">#&gt; Kar12W  Karlsruhe   &lt;NA&gt;       NA 49.100  8.320        NA         NA</span>
<span class="co">#&gt; Ner12R      Nerac   &lt;NA&gt;       NA 44.170  0.307        NA         NA</span></code></pre></div>
<p>After extracting the meta data, it can be modified and then added back to the original <code>TD</code> object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Set trial data as 1-1-2012.</span>
<span class="va">dropsMeta</span><span class="op">$</span><span class="va">trDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"010112"</span>, times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="st">"%d%m%y"</span><span class="op">)</span>
<span class="va">dropsTD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMeta.html">setMeta</a></span><span class="op">(</span>TD <span class="op">=</span> <span class="va">dropsTD</span>, meta <span class="op">=</span> <span class="va">dropsMeta</span><span class="op">)</span></code></pre></div>
</div>
<div id="addTD" class="section level2">
<h2 class="hasAnchor">
<a href="#addTD" class="anchor"></a>Add extra data to a <code>TD</code> object</h2>
<p>To add the data for the 2013 trials to the <code>TD</code> object the function <code>addTD</code> can be used. This function is very similar to <code>createTD</code> with the only exception that a <code>TD</code> object has to be specified to which the new data is added.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Add the data for the 2013 trials to the TD object.</span>
<span class="va">dropsTD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TD.html">addTD</a></span><span class="op">(</span>TD <span class="op">=</span> <span class="va">dropsTD</span>, 
                 data <span class="op">=</span> <span class="va">dropsRaw</span><span class="op">[</span><span class="va">dropsRaw</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2013</span>, <span class="op">]</span>,
                 genotype <span class="op">=</span> <span class="st">"Variety_ID"</span>, 
                 trial <span class="op">=</span> <span class="st">"Experiment"</span>,
                 loc <span class="op">=</span> <span class="st">"Site"</span>, 
                 repId <span class="op">=</span> <span class="st">"Replicate"</span>, 
                 subBlock <span class="op">=</span> <span class="st">"block"</span>,
                 rowCoord <span class="op">=</span> <span class="st">"Row"</span>, 
                 colCoord <span class="op">=</span> <span class="st">"Column"</span>, 
                 trLat <span class="op">=</span> <span class="st">"Lat"</span>, 
                 trLong <span class="op">=</span> <span class="st">"Long"</span><span class="op">)</span>

<span class="co">## Inspect the meta data after the extra trial was added.</span>
<span class="fu"><a href="../reference/getMeta.html">getMeta</a></span><span class="op">(</span>TD <span class="op">=</span> <span class="va">dropsTD</span><span class="op">)</span>
<span class="co">#&gt;         trLocation     trDate trDesign  trLat trLong trPlWidth trPlLength</span>
<span class="co">#&gt; Cam12R  Campagnola 2012-01-01       NA 45.171  9.532        NA         NA</span>
<span class="co">#&gt; Cra12R     Craiova 2012-01-01       NA 44.116 24.348        NA         NA</span>
<span class="co">#&gt; Gai12W     Gaillac 2012-01-01       NA 43.910  1.890        NA         NA</span>
<span class="co">#&gt; Kar12W   Karlsruhe 2012-01-01       NA 49.100  8.320        NA         NA</span>
<span class="co">#&gt; Ner12R       Nerac 2012-01-01       NA 44.170  0.307        NA         NA</span>
<span class="co">#&gt; Kar13R   Karlsruhe       &lt;NA&gt;       NA 49.100  8.320        NA         NA</span>
<span class="co">#&gt; Kar13W   Karlsruhe       &lt;NA&gt;       NA 49.100  8.320        NA         NA</span>
<span class="co">#&gt; Mar13R Martonvasar       &lt;NA&gt;       NA 47.311 18.778        NA         NA</span>
<span class="co">#&gt; Mur13R      Murony       &lt;NA&gt;       NA 46.780 21.050        NA         NA</span>
<span class="co">#&gt; Mur13W      Murony       &lt;NA&gt;       NA 46.780 21.050        NA         NA</span></code></pre></div>
<p><em>Note that the meta data now contains information about all ten trials. Only for the 2012 trials the trial date is filled. Since this information is not used in any of the analyses in the package we leave this.</em></p>
</div>
<div id="summarizing-a-td-object" class="section level2">
<h2 class="hasAnchor">
<a href="#summarizing-a-td-object" class="anchor"></a>Summarizing a <code>TD</code> object</h2>
<p>The <code>summary</code> function can be used to get an idea of the content of the data in the <code>TD</code> object. Multiple traits can be summarized at once but for clarity here a summary is only made for grain.yield for a single trial.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Create a summary for grain yield in Gai12W.</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
        trial <span class="op">=</span> <span class="st">"Gai12W"</span>, 
        traits <span class="op">=</span> <span class="st">"grain.yield"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary statistics for grain.yield in Gai12W  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                          grain.yield</span>
<span class="co">#&gt; Number of observations           483</span>
<span class="co">#&gt; Number of missing values          19</span>
<span class="co">#&gt; Mean                           11.23</span>
<span class="co">#&gt; Median                         11.22</span>
<span class="co">#&gt; Min                             6.71</span>
<span class="co">#&gt; Max                            14.68</span>
<span class="co">#&gt; First quantile                 10.38</span>
<span class="co">#&gt; Third quantile                 12.09</span>
<span class="co">#&gt; Variance                       1.845</span></code></pre></div>
<p>Using the default options, nine summary statistics are printed, but many more are available. These can be accessed using the parameter <code>what</code> in the <code>summary</code> function. For a full list of available statistics, use <code><a href="../reference/summary.TD.html">help(summary.TD)</a></code>. It is also possible to output all statistics using <code>what = "all"</code>.</p>
<p>It is possible to summarize the data in a TD object for different groups. This can be done using the parameter <code>groupBy</code>. It will display three main summary statistics per group. Again, more statistics can be displayed using the parameter <code>what</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Create a summary per family in Gai12W</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
        trial <span class="op">=</span> <span class="st">"Gai12W"</span>, 
        traits <span class="op">=</span> <span class="st">"grain.yield"</span>, 
        groupBy <span class="op">=</span> <span class="st">"geneticGroup"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary statistics for grain.yield in Gai12W grouped by geneticGroup </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                        Stiff_Stalk Iodent Other Lancaster</span>
<span class="co">#&gt; Number of observations         107     79   210        87</span>
<span class="co">#&gt; Mean                         11.85  11.42 10.61     11.80</span>
<span class="co">#&gt; Standard deviation           1.320  0.964 1.337     1.110</span></code></pre></div>
</div>
<div id="TDPlot" class="section level2">
<h2 class="hasAnchor">
<a href="#TDPlot" class="anchor"></a>Plotting a <code>TD</code> object</h2>
<p>Several plots can be made to further investigate the contents of a <code>TD</code> object.</p>
<p>In all plots the default colors for both genotype groups and trial groups are chosen from a predefined color palette. For genotype groups the color palette is “Dark 2,” for trial groups it is “Alphabet.” See <a href="https://developer.r-project.org/Blog/public/2019/11/21/a-new-palette-for-r/index.html">here</a> for an overview of these colors.</p>
<p>It is possible to specify different colors for genotype groups and trial groups per plot using the options <code>colGeno</code> and <code>colTrial</code> respectively. Also, more conveniently, the default colors can be set using the options <code>statgen.genoColors</code> and <code>statgen.trialColors</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Set default colors for genotypes and trials.</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="st">"statgen.genoColors"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"yellow"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="st">"statgen.trialColors"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"brown"</span>, <span class="st">"purple"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>If a plot has more genotype groups than the number of colors specified as default colors, the default colors will be ignored and <code><a href="https://rdrr.io/r/grDevices/palettes.html">topo.colors()</a></code> will be used instead. For trial groups this is done in a similar way.</p>
<div id="layPlot" class="section level3">
<h3 class="hasAnchor">
<a href="#layPlot" class="anchor"></a>Layout plot</h3>
<p>The default plot creates plots for the layout of all trials in the <code>TD</code> object. This can be restricted to selected trials using the <code>trials</code> parameter. The width and length of the plot are derived from “trPlWidth” and “trPlLength” in the meta data if these are available. If <code>repId</code> was specified when creating the <code>TP</code> object, replicate blocks are delineated by a black line. If subBlock was specified, then sub blocks are delineated by a blue line. This type of plot allows checking the design of the experiment.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     trials <span class="op">=</span> <span class="st">"Gai12W"</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/layoutPlot-1.png" width="672"></p>
<p><em>Note that the default title of the plot is the name of the trial. This can be manually changed using the <code>title</code> option.</em></p>
<p>This plot can be extended by highlighting interesting genotypes in the layout. By default the default ggplot colors are used for highlighting these genotypes. Custom colors can be specified using the parameter <code>colHighlight</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot the layout for Gai12W.</span>
<span class="co">## Highlight genotypes A3 and 11430 in red and blue.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     trials <span class="op">=</span> <span class="st">"Gai12W"</span>, 
     highlight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A3"</span>, <span class="st">"11430"</span><span class="op">)</span>,
     colHighlight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/layoutPlotHL-1.png" width="672"></p>
<p>It is also possible to color the sub blocks within the field. By default the default ggplot colors are used for coloring these sub blocks. Custom colors can be specified using the parameter <code>colSubBlock</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot the layout for Gai12W.</span>
<span class="co">## Color sub blocks using polychrome colors for high contrast.</span>
<span class="co">## Colors are specified here since this color palette is only available as such</span>
<span class="co">## from R &gt; 4.0.</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#5A5156"</span>, <span class="st">"#E4E1E3"</span>, <span class="st">"#F6222E"</span>, <span class="st">"#FE00FA"</span>, <span class="st">"#16FF32"</span>, <span class="st">"#3283FE"</span>, 
          <span class="st">"#FEAF16"</span>, <span class="st">"#B00068"</span>, <span class="st">"#1CFFCE"</span>, <span class="st">"#90AD1C"</span>, <span class="st">"#2ED9FF"</span>, <span class="st">"#DEA0FD"</span>, 
          <span class="st">"#AA0DFE"</span>, <span class="st">"#F8A19F"</span>, <span class="st">"#325A9B"</span>, <span class="st">"#C4451C"</span>, <span class="st">"#1C8356"</span>, <span class="st">"#85660D"</span>, 
          <span class="st">"#B10DA1"</span>, <span class="st">"#FBE426"</span>, <span class="st">"#1CBE4F"</span>, <span class="st">"#FA0087"</span>, <span class="st">"#FC1CBF"</span>, <span class="st">"#F7E1A0"</span>, 
          <span class="st">"#C075A6"</span>, <span class="st">"#782AB6"</span>, <span class="st">"#AAF400"</span>, <span class="st">"#BDCDFF"</span>, <span class="st">"#822E1C"</span>, <span class="st">"#B5EFB5"</span>, 
          <span class="st">"#7ED7D1"</span>, <span class="st">"#1C7F93"</span>, <span class="st">"#D85FF7"</span>, <span class="st">"#683B79"</span>, <span class="st">"#66B0FF"</span>, <span class="st">"#3B00FB"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     trials <span class="op">=</span> <span class="st">"Gai12W"</span>, 
     colorSubBlock <span class="op">=</span> <span class="cn">TRUE</span>,
     colSubBlock <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/layoutPlotSB-1.png" width="672"></p>
<p>Highlighting genotypes and coloring subBlocks cannot be done simultaneously. If both options are specified, only highlighting is done.</p>
<p>It is possible to add the labels of the genotypes to the layout.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot the layout for Gai12W, label the genotypes.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     trials <span class="op">=</span> <span class="st">"Gai12W"</span>, 
     showGeno <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/layoutPlotSG-1.png" width="672"></p>
<p>We can visualize the raw data of a given trait on the layout, as a heatmap. This type of plot gives a first indication of the spatial variability for a given trial. This can be further investigated with the spatial modeling. Missing plots are indicated in white.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot the layout for Gai12W, show raw data for grain yield.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     trials <span class="op">=</span> <span class="st">"Gai12W"</span>, 
     traits <span class="op">=</span> <span class="st">"grain.yield"</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/layoutPlotGY-1.png" width="672"></p>
</div>
<div id="mapPlot" class="section level3">
<h3 class="hasAnchor">
<a href="#mapPlot" class="anchor"></a>Map plot</h3>
<p>A second type of plot displays the trial locations on a map. This plot is made based on trLat and trLong in the meta data. If latitude or longitude is not available for a certain location, then this location is not plotted. If the locations are very close together, the resulting map can become quite small. The parameters <code>minLatRange</code> and <code>minLongRange</code> can be used to extend the minimum range of latitude and longitude respectively to address this issue. For map plots where there are many trials close together, the trial names can be left out of the plot by specifying <code>printTrialNames = FALSE</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot the locations of the trials on a map.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     plotType <span class="op">=</span> <span class="st">"map"</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/mapPlot-1.png" width="672"></p>
<p>It is possible to color the trials by a variable in the <code>TD</code> object using <code>colorTrialBy</code>. Colors may be specified in <code>colTrial</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Plot the locations of the trials on a map.</span>
<span class="co">## Color the trials by water scenario.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     plotType <span class="op">=</span> <span class="st">"map"</span>,
     colorTrialBy <span class="op">=</span> <span class="st">"scenarioWater"</span>,
     colTrial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/mapPlotCol-1.png" width="672"></p>
</div>
<div id="boxPlot" class="section level3">
<h3 class="hasAnchor">
<a href="#boxPlot" class="anchor"></a>Box plot</h3>
<p>Boxplots can be made to get an idea of the contents of the data in the <code>TD</code> object. By default a box is plotted per trial in the data for the specified traits. Boxplots for multiple traits can be made at once.</p>
<p>Boxplots can be made to visually assess the variability of the trait(s) in the <code>TD</code> object. By default a box is plotted per trial for the specified trait. Boxplots for multiple traits can be made at once.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Create a boxplot for grain yield.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     plotType <span class="op">=</span> <span class="st">"box"</span>, 
     traits <span class="op">=</span> <span class="st">"grain.yield"</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/boxPlot-1.png" width="672"></p>
<p>The trials in the boxplot can be grouped using the parameter <code>groupBy</code>. Colors can be applied to groups within trials using the parameter <code>colorTrialBy</code>. As in other plots <code>colTrial</code> may be used to specify the colors used. The boxes for the (groups of) trials can be ordered using <code>orderBy</code>. Boxes can be ordered alphabetically (<code>orderBy = alphabetic</code>), and by ascending (<code>orderBy = ascending</code>) and descending (<code>orderBy = descending</code>) trait mean.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Create a boxplot for grain yield with boxes grouped by year </span>
<span class="co">## Color the boxes by scenario within years.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     plotType <span class="op">=</span> <span class="st">"box"</span>, 
     traits <span class="op">=</span> <span class="st">"grain.yield"</span>, 
     groupBy <span class="op">=</span> <span class="st">"year"</span>, 
     colorTrialBy <span class="op">=</span> <span class="st">"scenarioFull"</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/boxPlotGR-1.png" width="672"></p>
</div>
<div id="corPlot" class="section level3">
<h3 class="hasAnchor">
<a href="#corPlot" class="anchor"></a>Correlation plot</h3>
<p>Another plot that can be made is a plot of the correlations between the trials for a specified trait. The order of the plotted trials is determined by clustering them and plotting closely related trials close to each other.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Create a correlation plot for grain yield.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     plotType <span class="op">=</span> <span class="st">"cor"</span>, 
     traits <span class="op">=</span> <span class="st">"grain.yield"</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/corPlot-1.png" width="672"></p>
</div>
<div id="scatPlot" class="section level3">
<h3 class="hasAnchor">
<a href="#scatPlot" class="anchor"></a>Scatter plot matrix</h3>
<p>Finally a scatter plot matrix can be made. The lower left of the matrix contains scatter plots between trials. The diagonal contains histograms of the data per trial. It is possible to calculate the correlation between trials and print it in the scatter plots by specifying <code>addCorr</code>. <code>addCorr</code> takes the values “tl” (top left), “tr” (top right), “bl” (bottom left) or “br” (bottom right). This indicates where the correlation is placed in each of the scatter plots. It is possible to color the genotypes and trials in the plots by a variable in the TD object by specifying <code>colorTrialBy</code> and <code>colorGenoBy</code> respectively.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Create a scatter plot matrix for grain yield.</span>
<span class="co">## Color trials by scenario and genotypes by family.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dropsTD</span>, 
     plotType <span class="op">=</span> <span class="st">"scatter"</span>, 
     traits <span class="op">=</span> <span class="st">"grain.yield"</span>, 
     colorTrialBy <span class="op">=</span> <span class="st">"scenarioFull"</span>, 
     colorGenoBy <span class="op">=</span> <span class="st">"geneticGroup"</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/scatPlot-1.png" width="768"></p>
<hr>
</div>
</div>
</div>
<div id="modeling" class="section level1">
<h1 class="hasAnchor">
<a href="#modeling" class="anchor"></a>Modeling</h1>
<p>To get genotypic predictions we want to accurately separate the genetic effects from the spatial effects and further design factors. To do this, for each trial a model can be fitted for the trait we are interested in. In <code>statgenSTA</code> models can be fitted using <em>SpATS</em> <span class="citation">(Rodríguez-Álvarez et al. 2018)</span>, <em>lme4</em> <span class="citation">(Bates et al. 2015)</span>, or <em>ASReml</em> <span class="citation">(Butler et al. 2017)</span>. For models with row column or resolvable row column design, SpATS is the default engine, for the other models lme4. This can always be overruled by specifying the function parameter <code>engine</code>.</p>
<p>Models can be fitted on the trial data in a <code>TD</code> object using the function <code>fitTD</code>. The exact model fitted depends on the design of the trial (see <a href="#modType"><strong>3.1</strong></a>). The design can be given as a parameter in the function or included in the meta data of the <code>TD</code> object as described in <a href="#meta"><strong>2.3</strong></a>. In the former case, the same model will be fitted for all trials, in the latter, different models can be fitted for different trials. If both are available the function parameter will always be leading.</p>
<p>The output of <code>fitTD</code> is an object of class <code>STA</code> (Single Site Analysis), a <code>list</code> of fitted models with one item for each trial the model was fitted for.</p>
<div id="modType" class="section level2">
<h2 class="hasAnchor">
<a href="#modType" class="anchor"></a>Model types</h2>
<p>Models can be fitted for five different trial designs. These are listed in the following table with their respective model specifications.</p>
<table class="table">
<colgroup>
<col width="34%">
<col width="10%">
<col width="54%">
</colgroup>
<thead><tr class="header">
<th>design</th>
<th>code</th>
<th>model fitted</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>incomplete block design</td>
<td>ibd</td>
<td>trait = <strong>subBlock</strong> + genotype + <span class="math inline">\(\epsilon\)</span>
</td>
</tr>
<tr class="even">
<td>resolvable incomplete block design</td>
<td>res.ibd</td>
<td>trait = <em>repId</em> + <strong>repId:subBlock</strong> + genotype + <span class="math inline">\(\epsilon\)</span>
</td>
</tr>
<tr class="odd">
<td>randomized complete block design</td>
<td>rcbd</td>
<td>trait = <em>repId</em> + genotype + <span class="math inline">\(\epsilon\)</span>
</td>
</tr>
<tr class="even">
<td>row column design</td>
<td>rowcol</td>
<td>trait = <strong>rowId</strong> + <strong>colId</strong> + genotype + <span class="math inline">\(\epsilon\)</span>
</td>
</tr>
<tr class="odd">
<td>resolvable row column design</td>
<td>res.rowcol</td>
<td>trait = <em>repId</em> + <strong>repId:rowId</strong> + <strong>repId:colId</strong> + genotype + <span class="math inline">\(\epsilon\)</span>
</td>
</tr>
</tbody>
</table>
<p>In the models above, fixed effects are indicated in <em>italics</em> whereas random effects are indicated in <strong>bold</strong>. genotype can be fitted as fixed or as random effect depending on the value of the parameter <code>what</code>. Extra fixed effects may be fitted using the parameter <code>covariates</code>.<br>
If SpATS is used as modeling engine, an extra spatial term is always included in the model (see <a href="#spMod"><strong>3.2</strong></a>). A spatial term is also included when the modeling engine is asreml and the function parameter <code>spatial</code> is set to <code>TRUE</code>.</p>
<p>Using the <code>TD</code> object dropsTD from the previous section, a model for the trial Gai12W and trait grain.yield can now be fitted on the data. The trial was set up using a resolvable row column design. This is specified in <code>fitTD</code> using the parameter <code>design</code>. Since <code>engine</code> is not supplied as a parameter, SpATS is used for fitting the model.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Fit a single trial model using a model based on a resolvable row column design.</span>
<span class="va">modDropsSp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitTD.html">fitTD</a></span><span class="op">(</span>TD <span class="op">=</span> <span class="va">dropsTD</span>, 
                    trials <span class="op">=</span> <span class="st">"Gai12W"</span>, 
                    traits <span class="op">=</span> <span class="st">"grain.yield"</span>,
                    design <span class="op">=</span> <span class="st">"res.rowcol"</span><span class="op">)</span></code></pre></div>
<p>Note that by not supplying the <code>what</code> argument to the function, two models are fitted, one with genotype as a fixed effect and one with genotype as a random effect. The results of both these models are stored in the <code>STA</code> object <code>modDropsSp</code>. This is very useful for extracting different results from the model later on. A trade-off is that fitting two models takes more time than fitting only one so when fitting models on large data sets it is sensible to explicitly define <code>what</code> if only a subset of the results is needed as output.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Fit a single trial model with genotype as random effect.</span>
<span class="va">modDropsSp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitTD.html">fitTD</a></span><span class="op">(</span>TD <span class="op">=</span> <span class="va">dropsTD</span>, 
                     trials <span class="op">=</span> <span class="st">"Gai12W"</span>, 
                     traits <span class="op">=</span> <span class="st">"grain.yield"</span>, 
                     what <span class="op">=</span> <span class="st">"random"</span>, 
                     design <span class="op">=</span> <span class="st">"res.rowcol"</span><span class="op">)</span></code></pre></div>
</div>
<div id="spMod" class="section level2">
<h2 class="hasAnchor">
<a href="#spMod" class="anchor"></a>Spatial models</h2>
<p>When using SpATS as a modeling engine for fitting a model, an extra spatial component is always included in the model. This spatial component is composed using the <code>PSANOVA</code> function in the SpATS package which uses 2-dimensional smoothing with P-splines as described in <span class="citation">Lee, Durbán, and Eilers (2013)</span> and in <span class="citation">Rodríguez-Álvarez et al. (2018)</span>. See <code><a href="https://rdrr.io/pkg/SpATS/man/PSANOVA.html">help(PSANOVA, SpATS)</a></code> for a detailed description. The parameters <code>nseg</code> and <code>nest.div</code> of <code>PSANOVA</code> can be modified using the <code>control</code> parameter in <code>fitTD</code>.<br>
The default number for the number of segments is (number of columns / 2, number of rows / 2). Fitting the model in the previous section specifying the number of segments for columns and rows as 28 and 18 respectively, works as follows:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Fit a spatial single trial model using SpATS. </span>
<span class="co">## Manually specify the number of segments for rows and columns.</span>
<span class="va">modDropsSp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitTD.html">fitTD</a></span><span class="op">(</span>TD <span class="op">=</span> <span class="va">dropsTD</span>, 
                     trials <span class="op">=</span> <span class="st">"Gai12W"</span>, 
                     traits <span class="op">=</span> <span class="st">"grain.yield"</span>, 
                     design <span class="op">=</span> <span class="st">"res.rowcol"</span>, 
                     control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>nSeg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Alternatively, spatial models can be fitted using asreml as modeling engine and setting the parameter <code>spatial = TRUE</code>. In this case seven models are fitted and the best model, based on a goodness-of-fit criterion, either AIC or BIC. The default is AIC, this can be modified the <code>control</code> parameter in <code>fitTD</code>.</p>
<p>The seven models fitted largely depend on the trial design. On top of the model described in the previous section extra random terms are added. These extra random terms depend on the structure of the data. If the trial has a regular structure, i.e. all replicates appear the same amount of times in the trial, the following combinations of random and spatial terms are fitted:</p>
<table class="table">
<thead><tr class="header">
<th>Random part</th>
<th>Spatial part</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>random effects based on design</td>
<td>none</td>
</tr>
<tr class="even">
<td>random effects based on design</td>
<td>AR1(rowId):colId</td>
</tr>
<tr class="odd">
<td>random effects based on design</td>
<td>rowId:AR1(colId)</td>
</tr>
<tr class="even">
<td>random effects based on design</td>
<td>AR1(rowId):AR1(colId)</td>
</tr>
<tr class="odd">
<td>random effects based on design + nugget</td>
<td>AR1(rowId):colId</td>
</tr>
<tr class="even">
<td>random effects based on design + nugget</td>
<td>rowId:AR1(colId)</td>
</tr>
<tr class="odd">
<td>random effects based on design + nugget</td>
<td>AR1(rowId):AR1(colId)</td>
</tr>
</tbody>
</table>
<p>If the design is not regular the following combinations of random and spatial terms are fitted:</p>
<table class="table">
<thead><tr class="header">
<th>Random part</th>
<th>Spatial part</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>random effects based on design</td>
<td>none</td>
</tr>
<tr class="even">
<td>random effects based on design</td>
<td>exp(rowCoord):colCoord</td>
</tr>
<tr class="odd">
<td>random effects based on design</td>
<td>rowCoord:exp(colCoord)</td>
</tr>
<tr class="even">
<td>random effects based on design</td>
<td>iexp(rowCoord, colCoord)</td>
</tr>
<tr class="odd">
<td>random effects based on design + nugget</td>
<td>exp(rowCoord):colCoord</td>
</tr>
<tr class="even">
<td>random effects based on design + nugget</td>
<td>rowCoord:exp(colCoord)</td>
</tr>
<tr class="odd">
<td>random effects based on design + nugget</td>
<td>iexp(rowCoord,colCoord)</td>
</tr>
</tbody>
</table>
<p>Fitting a model similar to the one above using asreml with BIC as goodness-of-fit criterion works as follows:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"asreml"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="co">## Fit a spatial single trial model using asreml.</span>
  <span class="va">modDropsAs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitTD.html">fitTD</a></span><span class="op">(</span>TD <span class="op">=</span> <span class="va">dropsTD</span>, 
                      trials <span class="op">=</span> <span class="st">"Gai12W"</span>, 
                      traits <span class="op">=</span> <span class="st">"grain.yield"</span>, 
                      design <span class="op">=</span> <span class="st">"res.rowcol"</span>, 
                      spatial <span class="op">=</span> <span class="cn">TRUE</span>, 
                      engine <span class="op">=</span> <span class="st">"asreml"</span>,
                      control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>criterion <span class="op">=</span> <span class="st">"BIC"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The fitted models and the best model are stored in the output together with a summary table with details on the fitted models.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"modDropsAs"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="co">## Overview of fitted models.</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">modDropsAs</span><span class="op">$</span><span class="va">Gai12W</span><span class="op">$</span><span class="va">sumTab</span><span class="op">$</span><span class="va">grain.yield</span>, digits <span class="op">=</span> <span class="fl">2</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">}</span>  
<span class="co">#&gt;    spatial random AIC BIC   H2    row   col   error correlated error converge</span>
<span class="co">#&gt;       none   &lt;NA&gt; 610 627 0.83     NA    NA 4.1e-01               NA     TRUE</span>
<span class="co">#&gt;   AR1(x)id   &lt;NA&gt; 611 633 0.83 -0.048    NA 4.0e-01               NA     TRUE</span>
<span class="co">#&gt;   id(x)AR1   &lt;NA&gt; 612 633 0.83     NA 0.039 4.1e-01               NA     TRUE</span>
<span class="co">#&gt;  AR1(x)AR1   &lt;NA&gt; 613 639 0.83 -0.042 0.026 4.1e-01               NA     TRUE</span>
<span class="co">#&gt;   AR1(x)id  units 611 633 0.83 -0.048    NA 6.5e-07            0.404     TRUE</span>
<span class="co">#&gt;   id(x)AR1  units 611 632 0.78     NA 0.403 2.8e-01            0.038     TRUE</span>
<span class="co">#&gt;  AR1(x)AR1  units 582 607 0.84  0.980 0.850 4.0e-01            0.177     TRUE</span></code></pre></div>
<p>As the overview shows, the best model, the model with the lowest BIC, is AR1(x)AR1 with units in the random part of the model.</p>
</div>
<div id="model-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#model-summary" class="anchor"></a>Model summary</h2>
<p>Since genotype has been fitted both as fixed and as random factor in <code>modDropsSp</code> it is possible to calculate both the Best Linear Unbiased Estimators (BLUEs) and the Best Linear Unbiased Predictors (BLUPs). Therefore both are printed in the summary of the model together with their respective standard errors.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Set nBest to 5 to limit the output to the best 5 genotypes.</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modDropsSp</span>, 
        nBest <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; Summary statistics </span>
<span class="co">#&gt; ==================</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Summary statistics for grain.yield in Gai12W  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                          grain.yield</span>
<span class="co">#&gt; Number of observations           483</span>
<span class="co">#&gt; Number of missing values          19</span>
<span class="co">#&gt; Mean                           11.23</span>
<span class="co">#&gt; Median                         11.22</span>
<span class="co">#&gt; Min                             6.71</span>
<span class="co">#&gt; Max                            14.68</span>
<span class="co">#&gt; First quantile                 10.38</span>
<span class="co">#&gt; Third quantile                 12.09</span>
<span class="co">#&gt; Variance                       1.845</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated heritability </span>
<span class="co">#&gt; ======================</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Heritability: 0.84 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Predicted means (BLUEs &amp; BLUPs) </span>
<span class="co">#&gt; ===============================</span>
<span class="co">#&gt; Best 5 genotypes</span>
<span class="co">#&gt;            BLUEs       SE    BLUPs     SE</span>
<span class="co">#&gt; Lo1261  13.97797  0.47111 13.65462 0.4329</span>
<span class="co">#&gt; Lo1253  13.90798  0.47146 13.44686 0.4350</span>
<span class="co">#&gt; Lo1223  13.71245  0.47115 13.27799 0.4337</span>
<span class="co">#&gt; DKMBST  13.66095  0.47214 13.23978 0.4346</span>
<span class="co">#&gt; HMV5422 13.60944  0.67929 13.02878 0.5784</span></code></pre></div>
</div>
<div id="model-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#model-plots" class="anchor"></a>Model plots</h2>
<p>Two types of plots can be made for fitted models.</p>
<div id="base-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#base-plots" class="anchor"></a>Base plots</h3>
<p>The first is a series of four plots, a histogram of the residuals, normal quantiles of the residuals, a scatter plot of residuals against fitted values and a scatter plot of absolute value of residuals against fitted values. These plots can be made by calling <code>plot</code> on the <code>STA</code> object. Plots can be made for multiple trials and multiple traits simultaneously, either for the model with genotype as fixed effect or for the model with genotype as random effect. By default plots are made for all trials and all traits, but this can be restricted using the parameters <code>trials</code> and <code>traits</code>. If only one model is fitted the results of the fitted model will be plotted. In case both models were fitted, as a default the results will be plotted for the model with genotype fixed. This can be changed using the parameter <code>what</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Base plots for the model with genotype fitted as random effect.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">modDropsSp</span>, 
     plotType <span class="op">=</span> <span class="st">"base"</span>, 
     what <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/basePlot-1.png" width="672"></p>
</div>
<div id="spatial-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#spatial-plots" class="anchor"></a>Spatial plots</h3>
<p>The second type of plot consists of five plots, spatial plots of the raw data, fitted values, residuals and either BLUEs or BLUPs, and a histogram of the BLUEs or BLUPs. If SpATS was used for modeling an extra plot with the fitted spatial trend is included. The spatial trend can be displayed on the original scale (<code>spaTrend = "raw"</code>) or as percentega (<code>spaTrend = "percentage"</code>). In the latter case the spatial trend is scaled (i.e., divided by the average of the observed response variable of interest across the field) and displayed as percentage. The call for creating these plots differs from the base plots only by an extra parameter <code>plotType = "spatial"</code>. Note that spatial plots can only be made if spatial information, i.e. <code>rowCoord</code> and <code>colCoord</code>, is available in the <code>TD</code> object.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Spatial plot for the model with genotype fitted as fixed effect.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">modDropsSp</span>, 
     plotType <span class="op">=</span> <span class="st">"spatial"</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/spatPlot-1.png" width="672"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Spatial plot for the model with genotype fitted as fixed effect.</span>
<span class="co">## Display the spatial trend as a percentage.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">modDropsSp</span>, 
     plotType <span class="op">=</span> <span class="st">"spatial"</span>, 
     spaTrend <span class="op">=</span> <span class="st">"percentage"</span><span class="op">)</span></code></pre></div>
<p><img src="statgenSTA_files/figure-html/spatPlotPerc-1.png" width="672"></p>
</div>
</div>
<div id="outlier-detection" class="section level2">
<h2 class="hasAnchor">
<a href="#outlier-detection" class="anchor"></a>Outlier detection</h2>
<p>After fitting a model, it is possible to run an outlier detection on the results. This outlier detection che cks the residuals in the fitted model and compares them to a limit. Observations with a residual higher than this limit are marked as outliers. The default limit is calculated based on the number of observations in the data. Setting a custom limit is also possible.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Outlier detection for the model with genotype fitted as random.</span>
<span class="va">outliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outlierSTA.html">outlierSTA</a></span><span class="op">(</span><span class="va">modDropsSp</span>, 
                       traits <span class="op">=</span> <span class="st">"grain.yield"</span>,
                       what <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span>
<span class="co">#&gt; Large standardized residuals.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   trial genotype       trait    value       res outlier</span>
<span class="co">#&gt;  Gai12W     B105 grain.yield 7.513174 -2.883388    TRUE</span></code></pre></div>
<p>The output of the outlier detection function is a data.frame with the outliers and of vector of indices of the outliers in the original data. This vector can be used for removing outliers from the data.</p>
<p>It is possible to run outlier detection on a model with genotype fitted as fixed, but when doing so it is only possible to detect outliers in genotypes that are replicated in the data. For unreplicated genotypes the residual will always be 0 and so these will never be marked as outliers.</p>
<p>To get an idea of the magnitude of the outliers, the parameter <code>commonFactors</code> can be used to see the values of observations with similar characteristics. In the example below, for all outliers also the other observations for the same genotype are shown.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Outlier detection for the model with genotype fitted as random.</span>
<span class="co">## A custom limit is used and commonFactors set to genotype.</span>
<span class="va">outliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/outlierSTA.html">outlierSTA</a></span><span class="op">(</span><span class="va">modDropsSp</span>, 
                       traits <span class="op">=</span> <span class="st">"grain.yield"</span>, 
                       what <span class="op">=</span> <span class="st">"random"</span>,
                       rLimit <span class="op">=</span> <span class="fl">2.7</span>, 
                       commonFactors <span class="op">=</span> <span class="st">"genotype"</span><span class="op">)</span>
<span class="co">#&gt; Large standardized residuals.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   trial genotype       trait     value       res outlier</span>
<span class="co">#&gt;  Gai12W     A347 grain.yield  8.767218 -2.769882    TRUE</span>
<span class="co">#&gt;  Gai12W     A347 grain.yield 10.448529  1.858846   FALSE</span>
<span class="co">#&gt;  Gai12W     B105 grain.yield  7.513174 -2.883388    TRUE</span>
<span class="co">#&gt;  Gai12W     B105 grain.yield  9.331618  1.446252   FALSE</span></code></pre></div>
</div>
<div id="model-reports" class="section level2">
<h2 class="hasAnchor">
<a href="#model-reports" class="anchor"></a>Model reports</h2>
<p>For <code>STA</code> objects there is a <code>report</code> function available in the <code>statgenSTA</code> package. This function creates a pdf report summarizing the main results of the fitted model. Also the tex file and figures used for generating the pdf report are saved. By editing the tex file it is possible to modify the report to ones needs, creating high flexibility.</p>
<p>When no outfile is specified, reports will be created with a default names, e.g. “modelReport_trial_trait_fixed_timestamp.pdf,” in the current working directory. The parameter <code>outfile</code> can be used to change the name and location of the report. The value of this parameter should be a valid location and name for a <strong>pdf</strong> file, i.e. including the postfix “.pdf.” Non-existing directories are created by the <code>report</code> function. When an outfile is supplied, trial, trait and modeltype (fixed or random) are concatenated to it in the name of the report.</p>
<p>The reports contains general information on the model fitted, a summary of the results, the plots described in the previous section, a <code>list</code> of best (highest BLUEs or BLUPs) genotypes and a scatter plot of all genotypes and their BLUEs or BLUPs. For some traits a low value might mean a genotype is performing well. To correctly show the best genotypes in the report in this case, set the parameter <code>descending</code> to <code>TRUE</code> in the report function.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Create a report in the current working directory</span>
<span class="fu"><a href="../reference/report.html">report</a></span><span class="op">(</span><span class="va">modDropsSp</span><span class="op">)</span>
<span class="co">## Create a report for the model with genotype fitted as random.</span>
<span class="fu"><a href="../reference/report.html">report</a></span><span class="op">(</span><span class="va">modDropsSp</span>, 
       outfile <span class="op">=</span> <span class="st">"./myReports/dropsReport.pdf"</span>, 
       what <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></code></pre></div>
<p>Reporting for an <code>STA</code> object can be done for multiple trials, traits and model types simultaneously. For each combination of trial, trait and model type, a separate .pdf report will be created. Parameters <code>traits</code>, <code>trials</code> and <code>what</code> can be used for specifying the models for which the reports should be made.</p>
<hr>
</div>
</div>
<div id="extracting-model-results" class="section level1">
<h1 class="hasAnchor">
<a href="#extracting-model-results" class="anchor"></a>Extracting model results</h1>
<p>After fitting a model, various results can be extracted or calculated from the fitted model using the function <code>extractSTA</code>. This can be anything from a single result for one trait and one trial to a <code>list</code> of different results for all models in an <code>STA</code> object. The results that can be extracted depend on the type of model fitted and sometimes on the modeling engine as well. For example, BLUEs can only extracted if genotype was fitted as a fixed effect. On the other hand, BLUPs and heritabilities can only be calculated and extracted if genotype was fitted as random effect.</p>
<p>All results that can be extracted are shown in the table below. In the first column is the result. This is also the value to be used for the parameter <code>what</code> in <code>extractSTA</code> needed to extract the corresponding result. The second column shows what model needs to be fitted in order to be able to extract the result. Here F stands for genotype as fixed effect and R for genotype as random effect. The third column gives a short description of the result that will be extracted and, where needed, also states for which modeling engines it can be extracted. The final columns shows whether the result can be extracted as a <code>data.frame</code> or not. Results that cannot be extracted as a <code>data.frame</code> will be extracted as a <code>list</code>. E.g. BLUES by default will be extracted in a <code>data.frame</code> and varCompF as a <code>list</code>. When extracting multiple results at once, the result will always be a <code>list</code>. E.g., when extracting BLUEs and BLUPs the result we be a list with two items per trial, named <code>BLUEs</code> and <code>BLUPs</code>.</p>
<table class="table">
<colgroup>
<col width="12%">
<col width="5%">
<col width="71%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">result</th>
<th align="left">model</th>
<th align="left">description</th>
<th align="left">asDataFrame</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BLUEs</td>
<td align="left">F</td>
<td align="left">Best Linear Unbiased Estimators</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">seBLUEs</td>
<td align="left">F</td>
<td align="left">standard errors of the BLUEs</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">ue</td>
<td align="left">F</td>
<td align="left">unit errors - only for lme4 and asreml</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">varCompF</td>
<td align="left">F</td>
<td align="left">variance components for the model with genotype as fixed component</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">fitted</td>
<td align="left">F</td>
<td align="left">fitted values for the model with genotype as fixed component</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">residF</td>
<td align="left">F</td>
<td align="left">residuals for the model with genotype as fixed component</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">stdResF</td>
<td align="left">F</td>
<td align="left">standardized residuals for the model with genotype as fixed component</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">wald</td>
<td align="left">F</td>
<td align="left">results of the wald test - only for lme4 and asreml</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">CV</td>
<td align="left">F</td>
<td align="left">Coefficient of Variation - only for lme4 and asreml</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">rDfF</td>
<td align="left">F</td>
<td align="left">residual degrees of freedom for the model with genotype as fixed component</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">sed</td>
<td align="left">F</td>
<td align="left">standard error of difference - only for asreml</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">lsd</td>
<td align="left">F</td>
<td align="left">least significant difference - only for asreml</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">BLUPs</td>
<td align="left">R</td>
<td align="left">Best Linear Unbiased Predictors</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">seBLUPs</td>
<td align="left">R</td>
<td align="left">standard errors of the BLUPs</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">heritability</td>
<td align="left">R</td>
<td align="left">broad sense heritability</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">varCompR</td>
<td align="left">R</td>
<td align="left">variance components for the model with genotype as random component</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">varGen</td>
<td align="left">R</td>
<td align="left">genetic variance component</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">varErr</td>
<td align="left">R</td>
<td align="left">residual variance component</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">varSpat</td>
<td align="left">R</td>
<td align="left">spatial variance components - only for SpATS</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">rMeans</td>
<td align="left">R</td>
<td align="left">fitted values for the model with genotype as random component</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">ranEf</td>
<td align="left">R</td>
<td align="left">random genetic effects</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">residR</td>
<td align="left">R</td>
<td align="left">residuals for the model with genotype as random component</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">stdResR</td>
<td align="left">R</td>
<td align="left">standardized residuals for the model with genotype as random component</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">rDfR</td>
<td align="left">R</td>
<td align="left">residual degrees of freedom for the model with genotype as random component</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">effDim</td>
<td align="left">R</td>
<td align="left">effective dimensions - only for SpATS</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">ratEffDim</td>
<td align="left">R</td>
<td align="left">ratios of the effective dimensions - only for SpATS</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><em>Note that when predictions are made (e.g. when extracting BLUEs, BLUPs or their standard errors), those predictions are always obtained by averaging over all levels of the fixed factors in the model.</em></p>
<p>Using <code>what = "all"</code> in the function call, extracts all results possible for the fitted model. This is also the default.</p>
<p>Below are some examples of extracting results from a fitted model. Recall that <code>modDropsSp</code> contains two fitted models, one with genotype as fixed effect and one with genotype as random effect.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Extract BLUEs.</span>
<span class="va">BLUEsDrops</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractSTA.html">extractSTA</a></span><span class="op">(</span>STA <span class="op">=</span> <span class="va">modDropsSp</span>, 
                         what <span class="op">=</span> <span class="st">"BLUEs"</span><span class="op">)</span>
<span class="co">## Extract BLUEs and BLUPs.</span>
<span class="va">predDrops</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractSTA.html">extractSTA</a></span><span class="op">(</span>STA <span class="op">=</span> <span class="va">modDropsSp</span>, 
                        what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUEs"</span>, <span class="st">"BLUPs"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><em>Note that <code>BLUEsDrops</code> is a data.frame, whereas <code>predDrops</code> is a list with one item, since we fitted a model for only one trial.</em></p>
<div id="adding-extra-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-extra-variables" class="anchor"></a>Adding extra variables</h2>
<p>The <code>data.frame</code> BLUEsDrops consists of only three columns, genotype, trial and grain.yield. If the model would have been fitted for multiple traits all these traits would become columns in the <code>data.frame</code>. It might be useful to add extra columns from the data used to fit the model to the output for use in further analysis of the data. This can be achieved using the paramater <code>keep</code> in <code>extractSTA</code>. To include the water scenario in the output, useful for using the BLUEs for a GxE analysis, use the following command:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Extract BLUEs from the fitted model.</span>
<span class="va">BLUEsDrops2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractSTA.html">extractSTA</a></span><span class="op">(</span>STA <span class="op">=</span> <span class="va">modDropsSp</span>, 
                          what <span class="op">=</span> <span class="st">"BLUEs"</span>, 
                          keep <span class="op">=</span> <span class="st">"scenarioWater"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">BLUEsDrops2</span><span class="op">)</span>
<span class="co">#&gt;   genotype  trial scenarioWater grain.yield</span>
<span class="co">#&gt; 1    11430 Gai12W            WW   11.708511</span>
<span class="co">#&gt; 2       A3 Gai12W            WW   11.554153</span>
<span class="co">#&gt; 3     A310 Gai12W            WW   11.072887</span>
<span class="co">#&gt; 4     A347 Gai12W            WW    9.511043</span>
<span class="co">#&gt; 5     A374 Gai12W            WW   10.908948</span>
<span class="co">#&gt; 6     A375 Gai12W            WW   10.823341</span></code></pre></div>
<p>Multiple columns can be included in the output in this way. Note that not every column from the original <code>TD</code> object can be included in the extracted data. Only columns that, for each genotype, have only one value per trial can be included. For example, the column <code>repId</code> containing replicates, that has several different values for a single genotype within each trial, cannot be included. When trying to do so it will be ignored with a warning.<br>
It is however possible to include <code>repId</code> when extracting fitted values, since for each observation in the original data a fitted value is computed.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Extract fitted values from the model.</span>
<span class="co">## Add repId and family to the output.</span>
<span class="va">fitVals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractSTA.html">extractSTA</a></span><span class="op">(</span>STA <span class="op">=</span> <span class="va">modDropsSp</span>, 
                      what <span class="op">=</span> <span class="st">"fitted"</span>, 
                      keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"repId"</span>, <span class="st">"geneticGroup"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fitVals</span><span class="op">)</span>
<span class="co">#&gt;   genotype  trial repId geneticGroup grain.yield</span>
<span class="co">#&gt; 1    DE811 Gai12W     1  Stiff_Stalk    9.796469</span>
<span class="co">#&gt; 2  UH_P089 Gai12W     1       Iodent   11.133917</span>
<span class="co">#&gt; 3    W182E Gai12W     1        Other    8.933867</span>
<span class="co">#&gt; 4      Lp5 Gai12W     1  Stiff_Stalk   11.975927</span>
<span class="co">#&gt; 5    F7082 Gai12W     1        Other    8.924579</span>
<span class="co">#&gt; 6   Lo1087 Gai12W     1  Stiff_Stalk   13.206323</span></code></pre></div>
</div>
<div id="prepare-data-for-gxe-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-data-for-gxe-analysis" class="anchor"></a>Prepare data for GxE analysis</h2>
<p>Performing a GxE analysis on can be done using the <a href="https://biometris.github.io/statgenGxE/index.html"><em>statgenGxE</em></a> package. This package uses the same input format for its analyses as the <code>statgenSTA</code> package.</p>
<p>To use the BLUEs or BLUPs from the fitted model in a GxE analysis they can easily be converted into a <code>TD</code> object using the function <code>STAtoTD</code>. This function creates a <code>TD</code> object from a fitted model including one or more of the following: BLUEs, standard errors of BLUEs, BLUPs and standard errors of BLUPs. Optionally, a column <code>wt</code> with weights (calculated as <span class="math inline">\((1 / seBLUEs)^2\)</span>) can be added as well. In the same way as described in the previous section extra columns can be added to the output using the parameter <code>keep</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Fit a model for all trials with genotype as fixed factor.</span>
<span class="va">modDropsSpTot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitTD.html">fitTD</a></span><span class="op">(</span>TD <span class="op">=</span> <span class="va">dropsTD</span>, 
                       traits <span class="op">=</span> <span class="st">"grain.yield"</span>, 
                       what <span class="op">=</span> <span class="st">"fixed"</span>, 
                       design <span class="op">=</span> <span class="st">"res.rowcol"</span><span class="op">)</span>
<span class="co">## Create a TD object containing BLUEs and standard errors of BLUEs.</span>
<span class="va">TDGxE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STAtoTD.html">STAtoTD</a></span><span class="op">(</span>STA <span class="op">=</span> <span class="va">modDropsSpTot</span>, 
                 what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUEs"</span>, <span class="st">"seBLUEs"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## Add weights and water scenario to the output.</span>
<span class="va">TDGxE2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/STAtoTD.html">STAtoTD</a></span><span class="op">(</span>STA <span class="op">=</span> <span class="va">modDropsSpTot</span>, 
                  what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUEs"</span>, <span class="st">"seBLUEs"</span><span class="op">)</span>, 
                  keep <span class="op">=</span> <span class="st">"scenarioWater"</span>,
                  addWt <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<hr>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bates2015" class="csl-entry">
Bates, Douglas, Martin Mächler, Ben Bolker, and Steve Walker. 2015. <span>“Fitting Linear Mixed-Effects Models Using Lme4.”</span> <em>Journal of Statistical Software</em> 67 (1). <a href="https://doi.org/10.18637/jss.v067.i01">https://doi.org/10.18637/jss.v067.i01</a>.
</div>
<div id="ref-Gilmour2017" class="csl-entry">
Butler, D. G., B. R. Cullis, A. R. Gilmour, B. G. Gogel, and R. Thompson. 2017. <span>“ASReml-r Reference Manual Version 4.”</span> <a href="https://www.vsni.co.uk/">https://www.vsni.co.uk/</a>.
</div>
<div id="ref-Lee2013" class="csl-entry">
Lee, Dae-Jin, María Durbán, and Paul Eilers. 2013. <span>“Efficient Two-Dimensional Smoothing with p-Spline ANOVA Mixed Models and Nested Bases.”</span> <em>Computational Statistics <span>&amp;</span> Data Analysis</em> 61 (May): 22–37. <a href="https://doi.org/10.1016/j.csda.2012.11.013">https://doi.org/10.1016/j.csda.2012.11.013</a>.
</div>
<div id="ref-Millet2019" class="csl-entry">
Millet, Emilie J., Cyril Pommier, Mélanie Buy, Axel Nagel, Willem Kruijer, Therese Welz-Bolduan, Jeremy Lopez, et al. 2019. <span>“A Multi-Site Experiment in a Network of European Fields for Assessing the Maize Yield Response to Environmental Scenarios.”</span> Portail Data Inra. <a href="https://doi.org/10.15454/IASSTN">https://doi.org/10.15454/IASSTN</a>.
</div>
<div id="ref-Millet2016" class="csl-entry">
Millet, Emilie, Claude Welcker, Willem Kruijer, Sandra Negro, Stephane Nicolas, Sebastien Praud, Nicolas Ranc, et al. 2016. <span>“Genome-Wide Analysis of Yield in Europe: Allelic Effects as Functions of Drought and Heat Scenarios.”</span> <em>Plant Physiology</em>, July, pp.00621.2016. <a href="https://doi.org/10.1104/pp.16.00621">https://doi.org/10.1104/pp.16.00621</a>.
</div>
<div id="ref-RodAlv2018" class="csl-entry">
Rodríguez-Álvarez, María, Martin P. Boer, Fred van Eeuwijk, and Paul H. C. Eilers. 2018. <span>“Correcting for Spatial Heterogeneity in Plant Breeding Experiments with p-Splines.”</span> <em>Spatial Statistics</em> 23 (October): 52–71. <a href="https://doi.org/10.1016/j.spasta.2017.10.003">https://doi.org/10.1016/j.spasta.2017.10.003</a>.
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bart-Jan van Rossum.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
